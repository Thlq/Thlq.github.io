(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{171:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("h1",{attrs:{id:"js-执行机制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#js-执行机制","aria-hidden":"true"}},[t._v("#")]),t._v(" JS 执行机制")]),t._v(" "),a("h2",{attrs:{id:"灵魂三问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#灵魂三问","aria-hidden":"true"}},[t._v("#")]),t._v(" 灵魂三问")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("JS 为什么是单线程?")])]),t._v(" "),a("li",[a("strong",[t._v("为什么需要异步?")])]),t._v(" "),a("li",[a("strong",[t._v("如何实现异步?")])])]),t._v(" "),a("h3",{attrs:{id:"js为什么是单线程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#js为什么是单线程","aria-hidden":"true"}},[t._v("#")]),t._v(" "),a("code",[t._v("JS")]),t._v("为什么是单线程?")]),t._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[a("code",[t._v("JS")]),t._v("是单线程和"),a("code",[t._v("JS")]),t._v("的用途有关，作为浏览器脚本语言，"),a("code",[t._v("JavaScript")]),t._v("的主要用途是与用户互动，以及操作"),a("code",[t._v("DOM")]),t._v("。这决定了它只能是单线程，否则会带来很复杂的同步问题。")]),t._v(" "),a("p",[t._v("如果现在有 2 个进程，"),a("code",[t._v("process1")]),t._v("，"),a("code",[t._v("process2")]),t._v("，由于"),a("code",[t._v("JS")]),t._v("是多进程的，所以他们对同一个"),a("code",[t._v("DOM")]),t._v("，同时进行操作，"),a("code",[t._v("process1")]),t._v("删除了该"),a("code",[t._v("DOM")]),t._v("，而 process2 编辑了该"),a("code",[t._v("DOM")]),t._v("，同时下达 2 个矛盾的命令，浏览器究就不知道怎么执行了。")]),t._v(" "),a("p",[t._v("为了利用多核"),a("code",[t._v("CPU")]),t._v("的计算能力，"),a("code",[t._v("HTML5")]),t._v("提出"),a("code",[t._v("Web Worker")]),t._v("标准，允许"),a("code",[t._v("JavaScript")]),t._v("脚本创建多个线程，但是子线程完全受主线程控制，且不得操作"),a("code",[t._v("DOM")]),t._v("。所以，这个新标准并没有改变"),a("code",[t._v("JavaScript")]),t._v("单线程的本质。")])]),t._v(" "),a("h3",{attrs:{id:"js为什么需要异步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#js为什么需要异步","aria-hidden":"true"}},[t._v("#")]),t._v(" "),a("code",[t._v("JS")]),t._v("为什么需要异步?")]),t._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("因为"),a("code",[t._v("JS")]),t._v("是单线程,单线程就意味着，所有任务需要排队，前一个任务结束，才会执行后一个任务。如果前一个任务耗时很长，后一个任务就不得不一直等着。如果排队是因为计算量大，CPU 忙不过来，倒也算了，但是很多时候 CPU 是闲着的，因为"),a("code",[t._v("IO")]),t._v("设备（输入输出设备）很慢（比如"),a("code",[t._v("Ajax")]),t._v("操作从网络读取数据），不得不等着结果出来，再往下执行。"),a("code",[t._v("JavaScript")]),t._v("语言的设计者意识到，这时主线程完全可以不管"),a("code",[t._v("IO")]),t._v("设备，挂起处于等待中的任务，先运行排在后面的任务。等到"),a("code",[t._v("IO")]),t._v("设备返回了结果，再回过头，把挂起的任务继续执行下去。")])]),t._v(" "),a("h3",{attrs:{id:"js如何实现异步"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#js如何实现异步","aria-hidden":"true"}},[t._v("#")]),t._v(" "),a("code",[t._v("JS")]),t._v("如何实现异步?")]),t._v(" "),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("JS 通过的事件循环(event loop),理解了 event loop 机制,就理解了 JS 的执行机制")])]),t._v(" "),a("h2",{attrs:{id:"事件循环-event-loop"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#事件循环-event-loop","aria-hidden":"true"}},[t._v("#")]),t._v(" 事件循环(event loop)")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1,3,2")]),t._v("\n")])])]),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("setTimeout 里的函数并没有立即执行,而是延迟了一段时间,满足一定条件后,才去执行的,这类代码,我们叫异步代码。")])]),t._v(" "),a("h3",{attrs:{id:"任务分类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#任务分类","aria-hidden":"true"}},[t._v("#")]),t._v(" 任务分类")]),t._v(" "),a("h4",{attrs:{id:"_1-同步任务和异步任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-同步任务和异步任务","aria-hidden":"true"}},[t._v("#")]),t._v(" 1. 同步任务和异步任务")]),t._v(" "),a("p",[t._v("按照这种分类方式,JS 的执行机制是")]),t._v(" "),a("ul",[a("li",[t._v("首先判断 JS 是同步还是异步,同步就进入主进程,异步就进入 event table")]),t._v(" "),a("li",[t._v("异步任务在 event table 中注册函数,当满足触发条件后,被推入 event queue")]),t._v(" "),a("li",[t._v("同步任务进入主线程后一直执行,直到主线程空闲时,才会去 event queue 中查看是否有可执行的异步任务,如果有就推入主进程中")])]),t._v(" "),a("p",[t._v("以上三步循环执行,这就是 event loop,再来看上面代码")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("// console.log(1) 是同步任务,放入主线程里\n// setTimeout() 是异步任务,被放入event table, 0秒之后被推入event queue里\n// console.log(3 是同步任务,放到主线程里\n// 当 1、 3在控制条被打印后,主线程去event queue(事件队列)\n// 里查看是否有可执行的函数,执行setTimeout里的函数\n")])])]),a("p",[t._v("再来分析下面代码")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"定时器开始啦"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resolve"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"马上执行for循环啦"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    i "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("==")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("99")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"执行then函数啦"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"代码执行结束"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 1. setTimeout 是异步任务,被放到event table")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 2. new Promise 是同步任务,被放到主进程里,")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 直接执行打印 console.log('马上执行for循环啦')")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3. .then里的函数是 异步任务,被放到event table")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 4. console.log('代码执行结束')是同步代码,被放到主进程里,直接执行")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//    马上执行for循环啦 > 代码执行结束 >")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//    定时器开始啦 > 执行then函数啦 ???")]),t._v("\n")])])]),a("div",{staticClass:"tip custom-block"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("p",[t._v("问题来了,异步任务的执行顺序,不是前后顺序,而是另有规定?")])]),t._v(" "),a("h4",{attrs:{id:"_2-事件按照异步和同步的划分方式-并不准确-精确的划分方式是"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-事件按照异步和同步的划分方式-并不准确-精确的划分方式是","aria-hidden":"true"}},[t._v("#")]),t._v(" 2.事件按照异步和同步的划分方式,并不准确,精确的划分方式是")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("macro-task(宏任务)")]),t._v(" "),a("th",[t._v("micro-task(微任务)")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("script")]),t._v(" "),a("td",[t._v("row 1 col 2")])]),t._v(" "),a("tr",[a("td",[t._v("setTimeout")]),t._v(" "),a("td",[t._v("Promise")])]),t._v(" "),a("tr",[a("td",[t._v("setInterval")]),t._v(" "),a("td",[t._v("process.nextTick")])])])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://wxopentest.miyapay.com/h5/Thlq/images/eventloop.png",alt:"image"}})]),t._v(" "),a("h4",{attrs:{id:"按照这种分类方式-js-的执行机制是"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#按照这种分类方式-js-的执行机制是","aria-hidden":"true"}},[t._v("#")]),t._v(" 按照这种分类方式:JS 的执行机制是")]),t._v(" "),a("ul",[a("li",[t._v("执行一个宏任务,过程中如果遇到微任务,就将其放到微任务的【事件队列】里")]),t._v(" "),a("li",[t._v("当前宏任务执行完成后,会查看微任务的【事件队列】,并将里面全部的微任务依次执行完")])]),t._v(" "),a("p",[t._v("重复以上 2 步骤,,就是更为准确的 JS 执行机制了。")])])}],!1,null,null,null);e.options.__file="README.md";s.default=e.exports}}]);